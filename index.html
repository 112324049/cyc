<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å¤§é˜ªå’Œæ­Œå±±éŠ (è¨ºæ–·æ¨¡å¼)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background-color: #fdfcf8; padding: 20px; font-family: monospace; }
        #log-area { 
            background: #000; color: #0f0; 
            padding: 15px; border-radius: 10px; 
            min-height: 300px; white-space: pre-wrap; word-break: break-all;
            font-size: 14px; margin-top: 20px;
        }
        .error { color: #ff5555; font-weight: bold; }
        .success { color: #55ff55; font-weight: bold; }
        button { background: #333; color: white; padding: 10px 20px; border-radius: 5px; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h1 class="text-xl font-bold mb-4">ğŸ¥ ç³»çµ±è¨ºæ–·æ¨¡å¼</h1>
    <p>å¦‚æœé›²ç«¯è¨˜å¸³è·‘ä¸å‹•ï¼Œè«‹æˆªåœ–ä¸‹æ–¹çš„é»‘è‰²æ¡†æ¡†çµ¦æˆ‘çœ‹ï¼š</p>
    
    <div id="log-area">æ­£åœ¨åˆå§‹åŒ–ç³»çµ±...<br></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, getDocs, addDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const logArea = document.getElementById('log-area');
        function log(msg, type = 'info') {
            const span = document.createElement('span');
            span.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}<br>`;
            if (type === 'error') span.className = 'error';
            if (type === 'success') span.className = 'success';
            logArea.appendChild(span);
        }

        // 1. æª¢æŸ¥ Firebase è¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyC_89NqMZPOuhOAkIgGYZou-ArNGG7tr0I",
            authDomain: "japan-trip-23e67.firebaseapp.com",
            projectId: "japan-trip-23e67",
            storageBucket: "japan-trip-23e67.firebasestorage.app",
            messagingSenderId: "189410602668",
            appId: "1:189410602668:web:51592ef3b0b5ab0c713909",
            measurementId: "G-ZKSY80ZS3T"
        };

        try {
            log("1. æ­£åœ¨å•Ÿå‹• Firebase...", "info");
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            log("âœ… Firebase å•Ÿå‹•æˆåŠŸï¼", "success");

            log("2. æ­£åœ¨å˜—è©¦é€£ç·šè³‡æ–™åº« (Firestore)...", "info");
            
            // å˜—è©¦è®€å–
            try {
                const querySnapshot = await getDocs(collection(db, "expenses"));
                log(`âœ… é€£ç·šæˆåŠŸï¼ç›®å‰æœ‰ ${querySnapshot.size} ç­†è³‡æ–™ã€‚`, "success");
                
                if (querySnapshot.size === 0) {
                    log("âš ï¸ è³‡æ–™åº«æ˜¯ç©ºçš„ï¼Œå˜—è©¦å¯«å…¥æ¸¬è©¦è³‡æ–™...", "info");
                    await addDoc(collection(db, "expenses"), {
                        test: true,
                        createdAt: new Date()
                    });
                    log("âœ… å¯«å…¥æ¸¬è©¦è³‡æ–™æˆåŠŸï¼æ‚¨çš„è³‡æ–™åº«å®Œå…¨æ­£å¸¸ï¼", "success");
                    log("ğŸ‰ è«‹å‘Šè¨´æˆ‘ã€Œæ¸¬è©¦æˆåŠŸã€ï¼Œæˆ‘çµ¦æ‚¨æ›å›æ­£å¼ç‰ˆï¼", "success");
                } else {
                    log("ğŸ‰ é€£ç·šå®Œå…¨æ­£å¸¸ï¼è«‹å‘Šè¨´æˆ‘ã€Œæ¸¬è©¦æˆåŠŸã€ï¼Œæˆ‘çµ¦æ‚¨æ›å›æ­£å¼ç‰ˆï¼", "success");
                }

            } catch (dbError) {
                console.error(dbError);
                log("âŒ è³‡æ–™åº«é€£ç·šå¤±æ•—ï¼", "error");
                log("éŒ¯èª¤ä»£ç¢¼: " + dbError.code, "error");
                log("éŒ¯èª¤è¨Šæ¯: " + dbError.message, "error");
                
                if (dbError.code === 'permission-denied') {
                    log("\nğŸ’¡ åŸå› ï¼šã€æ¬Šé™ä¸è¶³ã€‘\nè«‹å» Firebase Console -> Firestore Database -> Rules\næŠŠ allow read, write æ”¹æˆ if true;", "error");
                } else if (dbError.code === 'unavailable' || dbError.message.includes('offline')) {
                    log("\nğŸ’¡ åŸå› ï¼šã€ç¶²è·¯ä¸é€šã€‘\nå¯èƒ½æ˜¯å­¸æ ¡/å…¬å¸é˜²ç«ç‰†æ“‹ä½äº† Firebaseï¼Œæˆ–æ˜¯æ‚¨çš„æ‰‹æ©Ÿæ²’ç¶²è·¯ã€‚", "error");
                } else {
                    log("\nğŸ’¡ åŸå› ï¼šå¯èƒ½æ˜¯è³‡æ–™åº«é‚„æ²’å»ºç«‹ (Create Database)ã€‚è«‹ç¢ºèªæ‚¨æœ‰é»æ“Š 'Start in test mode'ã€‚", "error");
                }
            }

        } catch (e) {
            log("âŒ ç¨‹å¼ç™¼ç”Ÿåš´é‡éŒ¯èª¤ï¼š" + e.message, "error");
        }
    </script>
</body>
</html>
